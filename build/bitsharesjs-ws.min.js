!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.bitshares_ws=e()}}(function(){var e;return function e(t,n,o){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var i=e("./ChainWebSocket"),s=o(i),c=e("./GrapheneApi"),a=o(c),u=e("./ChainConfig"),l=o(u),d=void 0;n.default={setRpcConnectionStatusCallback:function(e){this.statusCb=e,d&&d.setRpcConnectionStatusCallback(e)},reset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ws://localhost:8090",t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;return d&&(d.close(),d=null),d=new f,d.setRpcConnectionStatusCallback(this.statusCb),d&&t&&d.connect(e,n),d},instance:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ws://localhost:8090",t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,o=arguments[3];return d||(d=new f,d.setRpcConnectionStatusCallback(this.statusCb)),d&&t&&d.connect(e,n,o),d},chainId:function(){return Apis.instance().chain_id},close:function(){d&&(d.close(),d=null)}};var f=function(){function e(){r(this,e)}return e.prototype.connect=function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,r="",i="";if("undefined"!=typeof window&&window.location&&"https:"===window.location.protocol&&e.indexOf("wss://")<0)throw new Error("Secure domains require wss connection");this.ws_rpc=new s.default(e,this.statusCb,t),this.init_promise=this.ws_rpc.login(r,i).then(function(){console.log("Connected to API node:",e),n._db=new a.default(n.ws_rpc,"database"),n._net=new a.default(n.ws_rpc,"network_broadcast"),n._hist=new a.default(n.ws_rpc,"history"),o&&(n._crypt=new a.default(n.ws_rpc,"crypto"));var t=n._db.init().then(function(){return n._db.exec("get_chain_id",[]).then(function(e){return n.chain_id=e,l.default.setChainId(e)})});n.ws_rpc.on_reconnect=function(){n.ws_rpc.login("","").then(function(){n._db.init().then(function(){n.statusCb&&n.statusCb("reconnect")}),n._net.init(),n._hist.init(),o&&n._crypt.init()})};var r=[t,n._net.init(),n._hist.init()];return o&&r.push(n._crypt.init()),Promise.all(r)})},e.prototype.close=function(){this.ws_rpc&&this.ws_rpc.close(),this.ws_rpc=null},e.prototype.db_api=function(){return this._db},e.prototype.network_api=function(){return this._net},e.prototype.history_api=function(){return this._hist},e.prototype.crypto_api=function(){return this._crypt},e.prototype.setRpcConnectionStatusCallback=function(e){this.statusCb=e},e}();t.exports=n.default},{"./ChainConfig":2,"./ChainWebSocket":3,"./GrapheneApi":4}],2:[function(e,t,n){(function(e){"use strict";n.__esModule=!0;var o=void 0,r={address_prefix:e.env.npm_config__graphene_ecc_default_address_prefix||"GPH"};o={core_asset:"CORE",address_prefix:"GPH",expire_in_secs:15,expire_in_secs_proposal:86400,review_in_secs_committee:86400,networks:{BitShares:{core_asset:"BTS",address_prefix:"BTS",chain_id:"4018d7844c78f6a6c41c6a552b898022310fc5dec06da467ee7905a8dad512c8"},Muse:{core_asset:"MUSE",address_prefix:"MUSE",chain_id:"45ad2d3f9ef92a49b55c2227eb06123f613bb35dd08bd876f2aea21925a67a67"},Test:{core_asset:"TEST",address_prefix:"TEST",chain_id:"39f5e2ede1f8bc1a3a54a7914414e3779e33193f1f5693510e73cb7a87617447"},Obelisk:{core_asset:"GOV",address_prefix:"FEW",chain_id:"1cfde7c388b9e8ac06462d68aadbd966b58f88797637d9af805b4560b0e9661e"}},setChainId:function(e){var t=void 0,n=void 0,i=void 0,s=void 0,c=void 0;for(c=Object.keys(o.networks),t=0,n=c.length;n>t;t++)if(s=c[t],i=o.networks[s],i.chain_id===e)return o.network_name=s,i.address_prefix&&(o.address_prefix=i.address_prefix,r.address_prefix=i.address_prefix),{network_name:s,network:i};o.network_name||console.log("Unknown chain id (this may be a testnet)",e)},reset:function(){o.core_asset="CORE",o.address_prefix="GPH",r.address_prefix="GPH",o.expire_in_secs=15,o.expire_in_secs_proposal=86400,console.log("Chain config reset")},setPrefix:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GPH";o.address_prefix=e,r.address_prefix=e}},n.default=o,t.exports=n.default}).call(this,e("_process"))},{_process:7}],3:[function(e,t,n){(function(o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var i=void 0;i="undefined"!=typeof WebSocket||o.env.browser?"undefined"!=typeof WebSocket&&"undefined"!=typeof document?e("ReconnectingWebSocket"):WebSocket:e("ws");var s=!1,c=function(){function e(t,n){var o=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;r(this,e),this.statusCb=n,this.connectionTimeout=setTimeout(function(){o.current_reject&&o.current_reject(new Error("Connection attempt timed out: "+t))},s);try{this.ws=new i(t)}catch(e){console.error("invalid websocket URL:",e,t),this.ws=new i("wss://127.0.0.1:8090")}this.ws.timeoutInterval=5e3,this.current_reject=null,this.on_reconnect=null,this.connect_promise=new Promise(function(e,t){o.current_reject=t,o.ws.onopen=function(){clearTimeout(o.connectionTimeout),o.statusCb&&o.statusCb("open"),o.on_reconnect&&o.on_reconnect(),e()},o.ws.onerror=function(e){clearTimeout(o.connectionTimeout),o.statusCb&&o.statusCb("error"),o.current_reject&&o.current_reject(e)},o.ws.onmessage=function(e){return o.listener(JSON.parse(e.data))},o.ws.onclose=function(){o.statusCb&&o.statusCb("closed")}}),this.cbId=0,this.cbs={},this.subs={},this.unsub={}}return e.prototype.call=function(e){var t=this,n=e[1];if(s&&console.log('[ChainWebSocket] >---- call ----->  "id":'+(this.cbId+1),JSON.stringify(e)),this.cbId+=1,("set_subscribe_callback"===n||"subscribe_to_market"===n||"broadcast_transaction_with_callback"===n||"set_pending_transaction_callback"===n)&&(this.subs[this.cbId]={callback:e[2][0]},e[2][0]=this.cbId),"unsubscribe_from_market"===n||"unsubscribe_from_accounts"===n){if("function"!=typeof e[2][0])throw new Error("First parameter of unsub must be the original callback");var o=e[2].splice(0,1)[0];for(var r in this.subs)if(this.subs[r].callback===o){this.unsub[this.cbId]=r;break}}var i={method:"call",params:e};return i.id=this.cbId,new Promise(function(e,n){t.cbs[t.cbId]={time:new Date,resolve:e,reject:n},t.ws.onerror=function(e){console.log("!!! ChainWebSocket Error ",e),n(e)},t.ws.send(JSON.stringify(i))})},e.prototype.listener=function(e){s&&console.log("[ChainWebSocket] <---- reply ----<",JSON.stringify(e));var t=!1,n=null;"notice"===e.method&&(t=!0,e.id=e.params[0]),n=t?this.subs[e.id].callback:this.cbs[e.id],n&&!t?(e.error?n.reject(e.error):n.resolve(e.result),delete this.cbs[e.id],this.unsub[e.id]&&(delete this.subs[this.unsub[e.id]],delete this.unsub[e.id])):n&&t?n(e.params[1]):console.log("Warning: unknown websocket response: ",e)},e.prototype.login=function(e,t){var n=this;return this.connect_promise.then(function(){return n.call([1,"login",[e,t]])})},e.prototype.close=function(){this.ws.close()},e}();n.default=c,t.exports=n.default}).call(this,e("_process"))},{ReconnectingWebSocket:5,_process:7,ws:6}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var r=function(){function e(t,n){o(this,e),this.ws_rpc=t,this.api_name=n}return e.prototype.init=function(){var e=this;return this.ws_rpc.call([1,this.api_name,[]]).then(function(t){return e.api_id=t,e})},e.prototype.exec=function(e,t){return this.ws_rpc.call([this.api_id,e,t]).catch(function(n){throw console.log("!!! GrapheneApi error: ",e,t,n,JSON.stringify(n)),n})},e}();n.default=r,t.exports=n.default},{}],5:[function(t,n){!function(t,o){"function"==typeof e&&e.amd?e([],o):"undefined"!=typeof n&&n.exports?n.exports=o():t.ReconnectingWebSocket=o()}(this,function(){function e(t,n,o){function r(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}var i={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};o||(o={});for(var s in i)this[s]="undefined"!=typeof o[s]?o[s]:i[s];this.url=t,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var c,a=this,u=!1,l=!1,d=null,f=document.createElement("div");f.addEventListener("open",function(e){a.onopen(e)}),f.addEventListener("close",function(e){a.onclose(e)}),f.addEventListener("connecting",function(e){a.onconnecting(e)}),f.addEventListener("message",function(e){a.onmessage(e)}),f.addEventListener("error",function(e){a.onerror(e)}),this.addEventListener=f.addEventListener.bind(f),this.removeEventListener=f.removeEventListener.bind(f),this.dispatchEvent=f.dispatchEvent.bind(f),this.open=function(t){if(c=new WebSocket(a.url,n||[]),c.binaryType=this.binaryType,t){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else f.dispatchEvent(r("connecting")),this.reconnectAttempts=0;(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",a.url);var o=c,i=setTimeout(function(){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",a.url),l=!0,o.close(),l=!1},a.timeoutInterval);c.onopen=function(){clearTimeout(i),(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",a.url),a.protocol=c.protocol,a.readyState=WebSocket.OPEN,a.reconnectAttempts=0;var n=r("open");n.isReconnect=t,t=!1,f.dispatchEvent(n)},c.onclose=function(n){if(clearTimeout(i),c=null,u)a.readyState=WebSocket.CLOSED,f.dispatchEvent(r("close"));else{a.readyState=WebSocket.CONNECTING;var o=r("connecting");o.code=n.code,o.reason=n.reason,o.wasClean=n.wasClean,f.dispatchEvent(o),t||l||((a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",a.url),f.dispatchEvent(r("close")));var i=a.reconnectInterval*Math.pow(a.reconnectDecay,a.reconnectAttempts);d=setTimeout(function(){a.reconnectAttempts++,a.open(!0)},i>a.maxReconnectInterval?a.maxReconnectInterval:i)}},c.onmessage=function(t){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",a.url,t.data);var n=r("message");n.data=t.data,f.dispatchEvent(n)},c.onerror=function(t){(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",a.url,t),f.dispatchEvent(r("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(t){if(c)return(a.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",a.url,t),c.send(t);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,t){"undefined"==typeof e&&(e=1e3),u=!0,c&&c.close(e,t),d&&(clearTimeout(d),d=null)},this.refresh=function(){c&&c.close()}}if("undefined"!=typeof window&&"WebSocket"in window)return e.prototype.onopen=function(){},e.prototype.onclose=function(){},e.prototype.onconnecting=function(){},e.prototype.onmessage=function(){},e.prototype.onerror=function(){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e})},{}],6:[function(){},{}],7:[function(e,t){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){b&&p&&(b=!1,p.length?h=p.concat(h):_=-1,h.length&&c())}function c(){if(!b){var e=r(s);b=!0;for(var t=h.length;t;){for(p=h,h=[];++_<t;)p&&p[_].run();_=-1,t=h.length}p=null,b=!1,i(e)}}function a(e,t){this.fun=e,this.array=t}function u(){}var l,d,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}}();var p,h=[],b=!1,_=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new a(e,t)),1!==h.length||b||r(c)},a.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}]},{},[1])(1)});